# flutter_nfc_kit_aurora
Данный прототип плагина представляет собой комплекс наработок для последующей реализации плагина [flutter_nfc_kit](https://pub.dev/packages/flutter_nfc_kit) фреймворка Flutter для мобильной ОС Аврора.

Требования к прототипу:

* прототип должен предоставлять возможность использования в приложениях на Flutter функционала NFC: считывание данных об адаптере NFC, а также считывание данных с NFC-меток технологий Type 1, Type 2, Type 4A и Type 4B;
* прототип должен использовать в качестве механизма доступа к функционалу NFC драйвер NFCD — драйвер устройств NFC в ОС Аврора, который управляется с помощью [D-Bus](https://ru.wikipedia.org/wiki/D-Bus) и представляет единственный механизм использования технологии NFC в данной операционной системе;
* API прототипа не должен включать синхронные методы, всё взаимодействие между платформой и приложением на Flutter должно осуществляться в асинхронном режиме. 

# Архитектура решения
Для решения поставленных выше задач адаптированы и реализованы компоненты, представленные ниже, а именно:
*	Компонент взаимодействия с системой D-Bus;
*	Компонент имплементации функционала [NFCD](https://developer.auroraos.ru/doc/software_development/reference/nfcd);
*	Компонент каналов платформы;
*	Компонент API плагина.

Под адаптацией компонентов взаимодействия с системой D-Bus и имплементации функционала NFCD подразумевается адаптация классов и методов, уже реализованных в официальном [примере](https://gitlab.com/omprussia/demos/NfcUseCases) использования функционала NFC приложениями на нативном для мобильной ОС Аврора фреймворке Qt.

Однако в случае компонента имплементации функционала NFCD официально были реализованы не все составляющие. Недостающий функционал был добавлен в процессе реализации прототипа плагина. 
В процессе разработки архитектуры прототипа плагина в соответствии с требованиями  были определены особенности проектируемого решения, влияющие на состав и функциональную принадлежность компонентов. 

__Перечень особенностей следующий:__
- Драйвер NFCD — это модуль объектно-ориентированной природы, взаимодействие с которым должно осуществляться с учётом основных принципов ООП.

  1) Для каждого интерфейса драйвера должен быть написан собственный класс-обработчик с приватными и публичными методами, а между объектами класса существует взаимосвязь по принципу «наследования». Базовым объектом считается объект класса «демона NFCD» — сервиса драйвера, подключаемого к D-Bus при запуске операционной системы и инкапсулирующего всё использованием функционала NFC.
  2) Объект демона NFCD создаёт объект класса адаптера NFC, с помощью которого можно взаимодействовать непосредственно с адаптером.
  3) Объект адаптера NFC создаёт объекты клаcсов-обработчиков.
  4) Объекты некоторых классов-обработчиков в неявном виде требуют или же подразумевают обязательное создание объектов некоторых других классов-обработчиков.
 	
- Для взаимодействий с различными типами интерфейсов тегов в NFCD реализованы различные интерфейсы, а именно:
  1) для взаимодействий с интерфейсами тегов Type 1 в NFCD реализован интерфейс Tag;
  2) для взаимодействий с интерфейсами тегов MIFARE Classic 1 в NFCD реализован интерфейс TagClassic;
  3) для чтения NDEF-записей в NFCD реализован интерфейс NDEF;
  4) для взаимодействия с интерфейсами тегов Type 2 в NFCD реализован интерфейс TagType2;
  5) для взаимодействия с интерфейсами тегов Type 4A и 4B в NFCD реализован интерфейс IsoDep.

- Компонент каналов платформы ввиду особенностей механизма и ОС Аврора должен быть разделён на два подкомпонента:
  1) «высокоуровневый» интерфейс каналов представляет собой API компонента для взаимодействия с компонентом API плагина;
  2) «низкоуровневый» обработчик взаимодействий с каналами — это компонент, написанный на основном для платформы языке и реализующий требуемое взаимодействие с каналами платформы.

# Рекомендации
***Для соответствия данного прототипа исходному плагину flutter_nfc_kit необходимо переписать компонент API.***

На данный момент API прототипа представляет собой набор интерфейсов для вызова всех доступных методов NFCD. В API исходного плагина подобные интерфейсы инкапсулированы в более общие методы, некоторые из которых строго платформозависимы (только для iOS или только для Android).
Т.е. неоюходимо:
1) Изучить API плагина flutter_nfc_kit;
2) Разобрать каждый метод API на составляющие;
3) Найти соответствующие методы в API прототипа;
4) Объединить методы API прототипа в соответствии с API исходного плагина, реализовать приведение к требуемым типам данных.


